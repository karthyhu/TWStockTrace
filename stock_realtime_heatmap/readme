# 台股即時熱力圖 (Taiwan Stock Realtime Heatmap)

## 專案概述
這是一個使用 Dash 和 Plotly 製作的台股即時熱力圖應用程式，能夠顯示股票按類別分組的即時漲跌情況。

## 熱力圖製作流程

### 1. 資料準備階段
- **載入基礎資料**: `load_initial_data()` 函數負責載入以下資料：
  - `stock_data.json`: 包含要追蹤的股票清單及其類別分組
  - `STOCK_DAY_0704.json`: 證交所股票的前一日收盤價資料
  - `tpex_mainboard_daily_close_quotes_0704.json`: 上櫃股票的前一日收盤價資料

### 2. 資料結構建立
- 使用 `get_stock_info()` 函數根據股票代碼查找：
  - 前一日收盤價
  - 股票名稱
  - 股票市場類型（TWSE 或 TPEx）

- 建立包含以下欄位的 DataFrame：
  - `category`: 股票所屬類別（支援多重類別）
  - `stock_type`: 股票市場類型
  - `stock_name`: 股票名稱
  - `last_day_price`: 前一日收盤價
  - `realtime_price`: 即時價格
  - `realtime_change`: 即時漲跌幅百分比

### 3. 即時資料更新
- 使用 `update_realtime_data()` 函數：
  - 透過 `twstock.realtime.get()` 獲取即時股價資料
  - 計算即時漲跌幅：`(current_price - last_day_price) / last_day_price * 100`
  - 處理特殊情況：當沒有最新成交價時，使用最佳買價一檔代替

### 4. 熱力圖視覺化
- 使用 Plotly Express 的 `px.treemap()` 建立樹狀圖：
  - **階層路徑**: `['stock_meta', 'category', 'stock_name']`（台股 → 類別 → 個股）
  - **顏色映射**: 根據 `realtime_change` 漲跌幅著色
  - **顏色範圍**: -10% 到 +10%，使用 RdYlGn_r 調色盤
  - **顏色中點**: 0（無漲跌）
  - **懸停資訊**: 顯示股票代碼、即時價格、前日收盤價、市場類型

### 5. 互動式更新
- 使用 Dash 的 `dcc.Interval` 組件每 3 秒自動更新一次
- 透過 `@app.callback` 裝飾器實現回調函數
- 顯示最後更新時間

## 技術特色

### 多重類別支援
- 股票可以屬於多個類別，在熱力圖中會重複顯示
- 使用列表儲存類別資訊，避免重複

### 即時性
- 每 3 秒更新一次股價資料
- 顯示最後更新時間戳

### 視覺化效果
- 使用樹狀圖展示分層結構
- 顏色漸變表示漲跌幅度
- 圓角邊框增加美觀度

## 使用的主要套件
- `dash`: Web 應用程式框架
- `plotly`: 視覺化圖表庫
- `pandas`: 資料處理
- `twstock`: 台股即時資料 API
- `json`: JSON 資料處理

## 執行方式
```bash
python Test3.py
```
然後在瀏覽器中開啟 http://127.0.0.1:8050/ 即可查看熱力圖。